<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SPLPetitParserSlideshow</title>

    <!-- browser setup -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">

    <!-- page meta information -->
    <meta name="description" content="This slideshow is for the PetitParser lecture of the compiler construction course at UniBE.">
    <meta property="og:type" content="article">
    <meta property="og:site_name" content="gtoolkit book">
    <meta property="og:title" content="SPLPetitParserSlideshow">
    <meta property="og:url" content="https://book.gtoolkit.com/index.html">
    <meta property="og:description" content="This slideshow is for the PetitParser lecture of the compiler construction course at UniBE.">

    <!-- CSS styles -->
    <link rel="stylesheet" href="assets/vendor/awesomefonts/css/all.css">
    <link rel="stylesheet" href="assets/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/v1/src/css/lepiter-common.css">
    <link rel="stylesheet" href="assets/v1/src/css/lepiter-snippets.css">
    <link rel="stylesheet" href="assets/v1/src/css/vs.css">
</head>
<body>

    <div class="content">
        <div class="container min-height py-5 le-main-container">
            <main>
                <h1 class="le-main-title">SPLPetitParserSlideshow</h1>

                <!-- page content start -->

                <div class="snippet textual-snippet text-snippet paragraphWidth">  <h2> Building composable parsers with PetitParser  </h2></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>This slideshow is for the PetitParser lecture of the <a href="https://seg.inf.unibe.ch/teaching/current/cc/">compiler construction course</a> at UniBE.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1000.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h2> What is PetitParser?  </h2></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p><a href="https://scg.unibe.ch/research/helvetia/petitparser">PetitParser</a> is a parsing framework that combines several related parsing technologies: scannerless parsers, parser combinators, parsing expression grammars and packrat parsers.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>The core idea is that parsers can be composed to form more complex parsers. That makes it convenient to develop and debug parsers.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>In this example the <code>number</code> parser is composed of a <code>#digit</code> parser, and converts the parsed string to a number. The <code>addition</code> parser is composed of <code>number</code> and <code>+</code> parsers and performs the addition.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1001.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h3> SPL Grammar  </h3></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>SPL is a simple, structured programming language with a compact grammar.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1002.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h3> An SPL example  </h3></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>SPL does not have procedures or objects, but it has loops, however, so it is still Turing-complete.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1003.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h2> Parsing tokens  </h2></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>PetitParser is a     <i>scannerless    </i> parser.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>This means we do not have a separate scanner for individual tokens based on regular expressions, but instead we use parsing expressions for tokens as well.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>We'll introduce parsing expressions for all of the SPL tokens, namely Boolens, integers, floats, strings, keywords and identifiers.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1004.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h3> Parsing Booleans  </h3></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>To parse a character or a string, we just send it the message <code>asParser</code>.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>Here we create two parsers, one which will parse the string <code>'true'</code>, and the other <code>'false'</code>.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>We compose them with the     <i>ordered choice    </i> operator, <code>/</code>, to parse either <code>true</code> or <code>false</code>.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1005.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h3> Parsing Integers and Floats  </h3></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>PetitParser makes use of numerous operators, or     <i>combinators    </i> to compose parsing expressions.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>The <code>optional</code> operator creates a new parser that will parser either zero or one token. The <code>plus</code> operators will parse ` or more tokens.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>The <code>not</code> operator does not consume a token, but simply fails if it sees the token, otherwise it succeeds. Here we make sure that an integer will only be recognized if there is no trailing period. If we add a period, the parse will fail.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>Parsing floats is similar, but in this case we     <i>do    </i> want the dot to be parsed.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1006.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h3> Parsing Numbers  </h3></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>We can now combine the parsing expressions to recognize numbers as either integers or floats.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>Note that the choice operator is strictly ordered. It will     <i>first    </i> attempt to parse an integer, and     <i>only if that fails    </i> will it try to parse a float.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1007.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h3> Parsing Keywords and Identifiers  </h3></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>Here we use the <code>not</code> combinator to make sure we don't accidentally recognize the token <code>and</code> in identifiers such as <code>android</code> or <code>andy</code>.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1008.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h2> Parsing grammar rules  </h2></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>Now we have parsing expressions for all the SPL tokens except strings. We can proceed to the actual grammar rules.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>The <code>trim</code> operator makes it easy to get rid of whitespace following a token. The <code>end</code> operator will match the end of input, making sure that everything is parsed.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1009.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h3> Debugging parsers  </h3></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>Here's a slightly buggy version of our <code>print</code> statement parser that fails with this input.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>The result is a PetitParser “Failure” object that shows us the execution trace of the parser at the point where it failed. If we inspect this, we can walk through the tree to see how far it got.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>We discover that after recognizing the “print” string, it expects a quotation mark for the start of a string, instead of whitespace. We fix this by adding the missing <code>trim</code> to the <code>print</code> parser.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1010.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h2> Prototyping the SPL grammar parser as a script  </h2></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>We continue to iteratively prototype the various SPL grammar rules until we have a complete grammar implemented as PetitParser parsing expressions.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>Note that we must take special care with recursive grammar rules, as we cannot use parsers that have not yet been defined.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>To break the recursion, the first time we introduce a recursive parser, such as <code>expression</code>, we define it as an instance of <code>PP2UnresolvedNode</code>. Then, once we have defined the other parsers that it needs for its own definition (and that use it recurseively, we     <i>redefine    </i> it use <code>def:</code>.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>We can see that <code>expression</code> is later redefined as <code>term</code>.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1011.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h3> Extracting a parser class  </h3></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>Once we have a working script, we can apply a refactoring transformation to turn it into a class.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>We initialize any recursive parsers, and then create a self-contained script that does not refer to any outside classe sor variables. We can right-click inside the script to <code>Extract PetitParser class</code>.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>This creates a class in which each parsing expression is defined as a method, and its value is cached as an instance variable.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1012.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h3> Writing parser tests  </h3></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>We write tests to ensure that each parsing expression and every grammar rule works as expected.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>It's good practice to subclass <code>PP2CompositeNodeExamples</code>, a class that offers some utilities for testing parsers. In this example we simply test that a small program source can be parsed by the <code>program</code> parser, but not by <code>declaration</code> or <code>statement</code>.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1013.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h2> Building the AST with parser actions  </h2></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>The parser we have created just recognizes SPL programs, but doesn't perform any actions. Now we'd like to build an abstract syntax tree for the programs that are recognized.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>In our very first example we saw that actions can be specified with the <code>==></code> double arrow operator, which points to a block (    <i>i.e.,    </i> an anonymous function) that can transform the parsed data into something useful. We'll define a     <i>subclass    </i> of our basic grammar parser that decorates each parsing expression with an action. Note that the <code>SPLParser</code> <code>printStmt</code> method inherits <code>printStmt</code> from the superclass and adds the action.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>For each grammar rule we'll create an instance of an <code>SPLNode</code> subclass that will store the interesting bits in the instance variables of the AST node. In this case we create an <code>SPLPrintStatement</code> node and store the second part that was parse, namely the expression to be printed.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>Now when we parse a bit of code with our refined parser expressions we get a proper AST node instead of an array of data.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1014.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h3> The SPL AST hierarchy  </h3></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>We introduce an AST node class for every different syntactic element of the SPL  grammar. Each leaf node can pretty-print itself, and can also perform an interpretation step.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1015.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h2> SPL Semantics  </h2></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>We don't just want to parse SPL programs, but we also want to execute them.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>This can be done in numerous ways. We could generate bytecode for a virtual machine for an existing language, like Java, or we could directly compile SPL programs to machine code.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>Another approach is to     <i>interpret    </i> SPL programs by transforming them, step-by-step, to simpler programs. This approach is called     <i>Structural Operational Semantics    </i>. We'd like to see each step of the execution, so we use what is called “small step” semantics.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>SPL programs don't take any input except what is specified in the source code itself. Programs have variables, so we need to track the bindings of variables to values, and we need to track any output that is produced. That means that the     <i>context    </i> of a running SPL program consists in three parts: (1) the current “continuation”,     <i>i.e.,    </i> the “rest of the program” to be executed,(2) the environment of variables and their values, and(3) the output so far.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>When we start executing, the continuation is the full program, the environment is empty, and so is the output.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>When the program ends, the continuation is empty (the empty program), the environment contains the set of all variables and their final values, and the output is the final list of everything that has been printed.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1016.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h3> The semantics of printing  </h3></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>Every SPL AST node has a <code>stepInContext:</code> method that allows it perform one reduction step, and return a new, reduced AST.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>Let's just look at one of these, namely that of the <code>print</code> statement. A print statement prints the value of an expression. The reduction step, then, should check if the expressions value is already known, in which case we can just print it. If not, we have to perform a reduction step.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>In the first case we return the AST for the reduced expression, which will be discarded in the next step, and in the second case, we return a new print statement AST with the expression redcued by one step. In either case we make some small progress.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1017.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h3> Running an SPL program  </h3></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>To run an SPL program, we create a new context holding the AST of the program as its continuation, and an empty environment and output. If we inspect this object, we can then step through the execution, and also explore the history of all the reductions steps.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1018.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h3> Fibonacci in SPL  </h3></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>Here's a Fibonacci program in SPL.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>Since SPL doesn't have procedures, we cannot define a Fibonacci function, but we can make it into a program. Also SPL programs don't take arguments, so we have to encode the argument as a variable in the first line.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>The algorithm simply keeps track of the last two Fibonacci values, printing out each new value computed, and terminating when we reach the required number of iterations.  </p></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>Notice how the semantics of the <code>while</code> statement has been implemented by     <i>unfolding    </i> the while into an if statement where the “then” part contains one iteration of the body followed by another copy of the while loop.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1019.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <h2> Coda  </h2></div><div class="snippet textual-snippet text-snippet paragraphWidth">  <p>You can explore the SPL case study for yourself by downloading Glamorous Toolkit from <a href="https://gtoolkit.com/">gtoolkit.com</a> and going to the page “PetitParser SPL case study” in the GT Book.  </p></div><figure class="snippet picture-snippet fullWidth"><img class="picture-snippet-image" src="gt-figures/1020.png"/></figure><div class="snippet textual-snippet text-snippet paragraphWidth"></div>

                <!-- page content end -->
            </main>
        </div>
    </div>

    <footer class="text-center py-5 le-footer">
        <p class="le-footer-credits">
            Powered by <a class="le-footer-link" href="https://lepiter.com">Lepiter</a> | <a class="le-footer-link" href="https://feenk.com/privacy">Privacy Policy</a>
        </p>
    </footer>

    <!-- scripts -->
    <script type="text/javascript" src="assets/vendor/jquery/js/jquery.js"></script>
    <script type="text/javascript" src="assets/vendor/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="assets/v1/src/js/datefns.min.js"></script>
    <script type="text/javascript" src="assets/v1/src/js/highlight.pack.js"></script>
    <script type="text/javascript" src="assets/v1/src/js/lepiter-common.js"></script>
    <script type="text/javascript" src="assets/v1/src/js/lepiter-snippets.js"></script>
    <script type="text/javascript" src="assets/v1/src/js/lepiter-time.js"></script>
</body>
</html>